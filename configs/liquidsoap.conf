# Liquidsoap Configuration for AutoDJ-Headless
# Offline rendering mode; no real-time audio I/O

# ==================== CLOCK & SYNC ====================
# Offline mode: no real-time constraints
set("clock.sync", false)

# ==================== AUDIO FORMAT ====================
# Match library: 44.1 kHz, stereo
set("frame.audio.samplerate", 44100)
set("frame.audio.channels", 2)

# ==================== MEMORY & PERFORMANCE ====================
# Disable unnecessary features for minimal memory footprint
set("server.telnet", false)          # No telnet server
set("server.socket", false)          # No socket server
set("log.file.path", "/app/data/logs/liquidsoap.log")

# ==================== BUFFER SIZES ====================
# Tuned for memory efficiency per SPEC.md ยง 5.3
set("frame.duration", 0.128)         # ~5.8 ms at 44.1 kHz
                                      # = 256 samples
                                      # Tradeoff: latency vs context

# ==================== AUDIO PROCESSING ====================
# Decoding: stream from disk
# - Use ffmpeg decoder (available in Dockerfile)
# - No preload (stream audio on-demand)

# Time-stretching (for BPM adjustments)
# - Liquidsoap native stretch operator, or
# - External aubio-based pitch-shifting

# Crossfading
# - smart_crossfade: beatmatched crossfade
# - fade curves: cosine for smoothness

# ==================== CODEC SETTINGS ====================
# MP3 output (main format per SPEC.md ยง 4.4)
set("encoder.mp3.bitrate", 192)      # kbps; matches config
set("encoder.mp3.quality", 7)        # VBR quality [0-9]

# FLAC output (optional lossless)
set("encoder.flac.compression", 5)   # [0-8]; 5 = default

# ==================== ERROR HANDLING ====================
# Fail fast on critical errors
set("frame.audio.drop_frame", false) # Don't silently drop frames
set("log.level", 3)                  # 3 = warn level (errors + warnings)

# ==================== TELEMETRY ====================
# Disable to reduce overhead
set("frame.audio.conversion.samplerate.converter", "linear")

# ==================== NOTES ====================
# This config is read-only; run commands are generated by render.py
# All mixing logic is expressed in Liquidsoap scripts (.liq files)
